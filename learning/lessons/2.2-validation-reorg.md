# Lesson 2.2: Advanced Content Validation & Reorganization

**Task:** Implement Step 2 (Organization) validation logic
**Completed:** Phase 2 (Validation Logic)

---

## üß† Key Concepts Learned

### 1. Strict Sequence Validation
Validating content *presence* is often insufficient; structure often requires specific *sequencing*.

**Challenge:** Ensuring headings in a reorganized draft match the exact order of the outline.

**Solution:**
Create specialized validators that extract and compare ordered lists of specific elements.

**Pattern:**
```python
def check_heading_order(outline, reorganized):
    # Extract only relevant elements (headings)
    outline_headings = [l for l in outline.split('\n') if l.startswith("## ")]
    reorg_headings = [l for l in reorganized.split('\n') if l.startswith("## ")]
    
    # 1. Exact match check
    if outline_headings == reorg_headings:
        return True, ""
        
    # 2. Detailed diagnostics (missing vs extra vs swapped)
    # ... logic to identify specific mismatch type ...
```

**Why:**
- Catches swapped sections (e.g., Conclusion before Body)
- Catches missing required sections
- Catches unauthorized extra sections

---

### 2. Filtering Mixed Content for Validation
When validating content preservation, you must distinguish between "expected content" and "metadata/instructions."

**Challenge:** An outline often contains *descriptions* of what to write (instructions), but the final draft contains *actual content* (text). A naive "set difference" check will flag the missing instructions as "lost content."

**Solution:**
Filter the source text to extract only the *structural elements* expected to persist.

**Pattern:**
```python
# Naive approach (FAIL): 
# outline_text includes descriptions -> flags descriptions as missing in draft
expected = normalize_and_split(outline_text) 

# Correct approach:
# Filter outline to only authorized headings
outline_lines = outline_text.split('\n')
expected_headings = {
    line.strip().lower() 
    for line in outline_lines 
    if line.strip().startswith('#') # Only expect headings to persist
}
expected_content = normalize_and_split(draft_ok) | expected_headings
```

**Takeaway:** Validation logic must understand the *semantics* of the input document (e.g., "This line is a heading to keep," "This line is a description to ignore").

---

### 3. Text Normalization consistency
Set-based comparison relies entirely on consistent normalization. Inconsistent splitting rules cause false positives.

**Challenge:** `split('\n\n')` vs `split('\n')` can lead to different grouping of headings and content.

**Solution:**
Standardize on the most atomic unit (single lines) for comparison, then normalize.

**Pattern:**
```python
def normalize_and_split(text):
    # Always split by single newline to treat headings and paragraphs as distinct items
    lines = text.split("\n")
    # Normalize each line individually
    return {line.strip().lower() for line in lines if line.strip()}
```

**Why:** Prevents "Heading\nContent" from being treated as a single unique string that fails to match separate "Heading" and "Content" strings.

---

### 4. TDD for Validation Logic
Writing tests *before* the validator is critical for defining the expected behavior, especially for edge cases.

**Process:**
1.  **Write Tests (Red):** Define scenarios like "Outline with descriptions", "Swapped order", "Missing content".
2.  **Observe Failure:** Confirm tests fail (e.g., "Outline with descriptions" fails naive integrity check).
3.  **Implement Fix (Green):** Update logic to filter descriptions.
4.  **Verify:** All tests pass.

**Benefit:** Ensures validation logic is robust against specific content nuances (like descriptive text in outlines) that might otherwise cause false alarms.

---

## üìù Files Created

- `blogger/validation_utils.py` - Added `check_reorganization_integrity` and `check_heading_order`
- `blogger/validation_checkers.py` - Added `ReorganizationValidationChecker`
- `tests/test_validation_reorg.py` - Tests for content integrity
- `tests/test_validation_order.py` - Tests for heading order

---

## üéØ Takeaway

Validation is not just "does it exist?" It requires semantic understanding of **structure** (order) and **intent** (what should persist vs. what is instructional). Pure functions with TDD are the best way to build this robust logic.

```